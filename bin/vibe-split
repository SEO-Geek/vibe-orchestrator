#!/bin/bash
# Vibe Split Terminal Launcher
# Left pane: Vibe orchestrator
# Right pane: Claude live output

VIBE_DIR="/home/brian/vibe"
VENV_PATH="$VIBE_DIR/venv/bin/activate"
LIVE_LOG="$HOME/.config/vibe/claude-live.log"
SESSION="vibe"

# Check tmux
if ! command -v tmux &> /dev/null; then
    echo "Error: tmux not installed. Run: sudo apt install tmux"
    exit 1
fi

# Check terminal
if [ ! -t 0 ]; then
    echo "Error: Not in a terminal"
    exit 1
fi

# Setup log
mkdir -p "$(dirname "$LIVE_LOG")"
echo "=== Claude Live Output ===" > "$LIVE_LOG"
echo "Waiting for tasks..." >> "$LIVE_LOG"

# Kill old session
tmux kill-session -t "$SESSION" 2>/dev/null

# Create session with split IN ONE COMMAND (critical for WSL)
exec tmux new-session -s "$SESSION" \
    "source $VENV_PATH && cd $VIBE_DIR && vibe $*; read -p 'Press Enter to exit...'" \; \
    split-window -h -l 40% \
    "tail -f $LIVE_LOG; read -p 'Press Enter...'" \; \
    select-pane -t 0
